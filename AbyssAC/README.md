# 🧠 AbyssAC - 人工意识系统

AbyssAC是一个基于NNG（导航节点图）和Y层记忆的AI操作系统反馈系统，实现了具有长期记忆能力的对话系统。

## 📋 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      用户交互层 (Gradio)                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    X层AI操作系统 - 三层沙盒                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 第一层沙盒   │  │ 第二层沙盒   │  │ 第三层沙盒           │  │
│  │ 导航定位    │→│ 记忆筛选    │→│ 上下文组装          │  │
│  │ (选择NNG)   │  │ (选择记忆)   │  │ (整合上下文)         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
┌─────────────────────────┐    ┌─────────────────────────────┐
│      Y层记忆库           │    │      NNG导航节点图           │
│  ├─ 元认知记忆           │    │  ├─ root.json               │
│  ├─ 高阶整合记忆         │    │  ├─ 1/1.json, 1/            │
│  ├─ 分类记忆             │    │  ├─ 1/1.1/1.1.json          │
│  │   ├─ 高价值           │    │  └─ ...                     │
│  │   ├─ 中价值           │    │                             │
│  │   └─ 低价值           │    │  节点包含:                  │
│  └─ 工作记忆             │    │  - 定位、关联性、置信度      │
│                          │    │  - 内容、关联记忆摘要        │
└─────────────────────────┘    └─────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              DMN动态维护网络 - 五个子智能体                    │
│  Agent1: 问题输出 → Agent2: 问题分析 → Agent3: 审查         │
│                          ↓                                   │
│  Agent5: 格式审查 ← Agent4: 整理 ← 审查通过                 │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆或下载项目
cd AbyssAC

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置LLM

AbyssAC支持多种LLM接入方式：

#### 方式一：Ollama（推荐，本地免费）

```bash
# 安装Ollama
# macOS: https://ollama.com/download
# Linux: curl -fsSL https://ollama.com/install.sh | sh

# 拉取模型
ollama pull qwen2.5

# 启动服务（默认端口11434）
ollama serve
```

#### 方式二：LM Studio

1. 下载并安装 [LM Studio](https://lmstudio.ai/)
2. 下载模型（如 Qwen2.5）
3. 启动本地服务器（默认端口1234）

#### 方式三：OpenAI API

需要准备API Key。

### 3. 启动系统

```bash
# 启动Gradio界面（默认）
python main.py

# 启动命令行模式
python main.py --cli

# 指定LLM配置
python main.py --provider ollama --model qwen2.5 --url http://localhost:11434
```

### 4. 访问界面

启动后打开浏览器访问：`http://localhost:7860`

## 📁 项目结构

```
AbyssAC/
├── main.py                 # 主入口
├── config.py               # 系统配置
├── requirements.txt        # 依赖列表
├── README.md              # 本文件
│
├── core/                   # 核心模块
│   ├── __init__.py
│   ├── llm_client.py      # LLM客户端
│   ├── memory_manager.py  # Y层记忆管理
│   ├── nng_manager.py     # NNG导航管理
│   ├── sandbox.py         # X层三层沙盒
│   ├── dmn.py             # DMN五个子智能体
│   └── system.py          # 系统主控制器
│
├── frontend/              # 前端界面
│   └── app.py             # Gradio界面
│
├── tests/                 # 测试模块
│   └── test_all.py        # 自测脚本
│
└── data/                  # 数据目录
    ├── Y层记忆库/          # 记忆存储
    │   ├── id_counter.txt
    │   ├── 元认知记忆/
    │   ├── 高阶整合记忆/
    │   ├── 分类记忆/
    │   │   ├── 高价值/
    │   │   ├── 中价值/
    │   │   └── 低价值/
    │   └── 工作记忆/
    └── nng/               # NNG导航图
        └── root.json
```

## 🔧 系统配置

编辑 `config.py` 修改默认配置：

```python
LLM_CONFIG = {
    "provider": "ollama",           # ollama / lmstudio / openai
    "base_url": "http://localhost:11434",
    "model": "qwen2.5",
    "api_key": "",                  # API方式需要
    "temperature": 0.7,
    "max_tokens": 4096,
}

DMN_TRIGGER = {
    "working_memory_threshold": 20,     # 工作记忆阈值
    "navigation_failure_threshold": 5,  # 导航失败阈值
    "idle_time_seconds": 300,           # 空闲时间(5分钟)
}
```

## 🎮 使用指南

### 1. 初始化系统

首次使用需要在「系统配置」标签页点击「初始化系统」。

### 2. 开始对话

在「对话」标签页输入消息，系统会自动：
- 保存对话到工作记忆
- 判断是否需要调取长期记忆
- 通过三层沙盒流程获取相关记忆
- 生成回复

### 3. 记忆管理

- **工作记忆**：当前对话的临时存储
- **长期记忆**：通过DMN自动整理沉淀
- **NNG导航**：知识的结构化组织

### 4. DMN触发

DMN（动态维护网络）自动触发条件：
- 工作记忆 ≥ 20条
- 导航失败 ≥ 5次
- 系统空闲 ≥ 5分钟

也可以手动在「对话」标签页点击「手动触发DMN」。

### 5. 查看记忆

在「记忆查看」标签页可以：
- 查看NNG导航图结构
- 查看工作记忆内容
- 清空工作记忆

## 🧪 自测

```bash
# 运行自测
python main.py --test

# 或直接运行测试脚本
python tests/test_all.py
```

自测包含以下模块：
- ✅ 记忆管理（保存、获取、更新、删除、计数）
- ✅ NNG管理（创建、更新、删除、结构获取）
- ✅ LLM客户端（JSON解析）

## 📊 系统流程

### Bootstrap流程

```
阶段1: NNG为空
    ↓
用户输入 → 直接回复 → 存入工作记忆
    ↓
阶段2: 工作记忆 ≥ 20条，首次DMN触发
    ↓
创建时间目录 → 创建价值子目录 → 生成记忆文件
    ↓
生成NNG节点 → 更新root.json
    ↓
阶段3: 正常运行
    ↓
NNG有节点 → X层三层沙盒开始工作
```

### 对话流程

```
用户输入
    ↓
保存到工作记忆
    ↓
[NNG为空?] → 是 → 直接生成回复
    ↓ 否
第一层沙盒: 导航定位
    ↓
第二层沙盒: 记忆筛选
    ↓
第三层沙盒: 上下文组装
    ↓
生成回复
    ↓
保存AI回复到工作记忆
    ↓
检查DMN触发条件
```

## 🔍 核心概念

### Y层记忆库

| 记忆类型 | 说明 | 价值层级 |
|---------|------|---------|
| 元认知记忆 | 系统对自身认知的记录和反思 | - |
| 高阶整合记忆 | 深度加工的知识结构 | - |
| 分类记忆 | 按主题分类的记忆 | 高/中/低 |
| 工作记忆 | 当前任务的临时记忆 | - |

### NNG导航节点

```json
{
    "定位": "1.2.3",
    "关联性": 85,
    "置信度": 90,
    "时间": "2026-02-08 12:00:00",
    "内容": "节点描述",
    "关联的记忆文件摘要": [
        {
            "记忆ID": 1,
            "摘要": "记忆摘要",
            "记忆类型": "工作",
            "价值层级": "高"
        }
    ]
}
```

### 三层沙盒

| 层级 | 功能 | 输入 | 输出 |
|-----|------|------|------|
| 第一层 | 导航定位 | 用户输入 + NNG结构 | 选中的NNG节点 |
| 第二层 | 记忆筛选 | NNG节点 + 关联记忆 | 选中的记忆 |
| 第三层 | 上下文组装 | 选中记忆 + 工作记忆 | 整合后的上下文 |

### DMN五个子智能体

| 智能体 | 功能 | 输入 | 输出 |
|-------|------|------|------|
| Agent1 | 问题输出 | 工作记忆 | 问题列表 |
| Agent2 | 问题分析 | 问题列表 | 分析结果 |
| Agent3 | 审查 | 分析结果 | 通过/不通过 |
| Agent4 | 整理 | 分析结果 | 标准格式 |
| Agent5 | 格式审查 | 标准格式 | 通过/不通过 |

## ⚠️ 注意事项

1. **LLM连接**：确保Ollama/LM Studio等服务已启动
2. **模型选择**：建议使用支持中文的模型（如qwen2.5）
3. **存储空间**：长期运行会产生大量记忆文件
4. **并发安全**：文件操作已加锁，但建议单实例运行
5. **首次运行**：NNG为空时跳过沙盒，直接对话

## 🔧 故障排除

### LLM连接失败

```bash
# 测试Ollama
curl http://localhost:11434/api/tags

# 测试LM Studio
curl http://localhost:1234/v1/models
```

### 记忆未保存

检查 `data/Y层记忆库/` 目录权限和磁盘空间。

### NNG导航失败

- 检查 `data/nng/` 目录结构
- 尝试手动触发DMN整理记忆

## 📄 许可证

GNU AGPLv3

## 🤝 贡献

欢迎提交Issue和PR！

## 📧 联系

如有问题，请通过邮箱联系。

---

**AbyssAC** - 探索AI意识的深渊 🌊
