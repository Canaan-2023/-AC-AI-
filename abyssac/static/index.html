<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbyssAC - 人工意识系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons-sprite.svg">
    <style>
        .step-item {
            padding: 8px 16px;
            border-radius: 4px;
            background: #f1f5f9;
            margin-right: 8px;
            font-size: 14px;
        }
        .step-item.active {
            background: #206bc4;
            color: white;
        }
        .step-item.completed {
            background: #2fb344;
            color: white;
        }
        .step-item.error {
            background: #d63939;
            color: white;
        }
        .nng-tree-item {
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .nng-tree-item:hover {
            background: #f1f5f9;
        }
        .nng-tree-children {
            margin-left: 20px;
            border-left: 2px solid #e2e8f0;
            padding-left: 8px;
        }
        .chat-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .chat-message.user {
            background: #e3f2fd;
            margin-left: 20%;
        }
        .chat-message.assistant {
            background: #f3e5f5;
            margin-right: 20%;
        }
        .status-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .log-item {
            font-size: 13px;
            padding: 6px 12px;
        }
        #notificationBar {
            transition: all 0.3s ease;
        }
        .memory-stat-card {
            text-align: center;
            padding: 16px;
        }
        .memory-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #206bc4;
        }
        .memory-stat-label {
            font-size: 12px;
            color: #64748b;
        }
    </style>
</head>
<body class="theme-light">
    <div class="container-fluid py-3">
        <!-- 顶部系统栏 -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-body d-flex justify-content-between align-items-center py-2">
                        <div class="d-flex align-items-center gap-3">
                            <h1 class="h3 mb-0 me-3">AbyssAC</h1>
                            <span class="badge bg-success status-badge" id="systemStatus">系统空闲</span>
                            <span class="text-muted" id="currentTime">--</span>
                            <select class="form-select form-select-sm" style="width: 220px;" id="sessionSelector">
                                <option value="">选择会话...</option>
                            </select>
                            <button class="btn btn-sm btn-outline-primary" id="newSessionBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-plus" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M12 5l0 14" />
                                    <path d="M5 12l14 0" />
                                </svg>
                                新建会话
                            </button>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span>DMN: <span class="badge bg-secondary" id="dmnStatus">未运行</span></span>
                            <button class="btn btn-sm btn-outline-primary" id="triggerDMN" data-bs-toggle="modal" data-bs-target="#dmnModal">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brain" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M15.5 13a3.5 3.5 0 0 0 -3.5 3.5v1a3.5 3.5 0 0 0 7 0v-1.8" />
                                    <path d="M8.5 13a3.5 3.5 0 0 1 3.5 3.5v1a3.5 3.5 0 0 1 -7 0v-1.8" />
                                    <path d="M17.5 16a3.5 3.5 0 0 0 0 -7h-.5" />
                                    <path d="M19 9.3v-2.8a1.5 1.5 0 0 0 -1.5 -1.5h-1" />
                                    <path d="M14.5 5a3.5 3.5 0 0 0 -7 0" />
                                    <path d="M6.5 5h-.5a1.5 1.5 0 0 0 -1.5 1.5v2.8" />
                                    <path d="M6.5 9a3.5 3.5 0 0 0 0 7h.5" />
                                </svg>
                                手动触发DMN
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 四分屏主体 -->
        <div class="row">
            <!-- 左上面板：用户交互区 -->
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-circle" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1" />
                            </svg>
                            用户交互
                        </h3>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="mb-3">
                            <textarea class="form-control" id="userInput" rows="3" placeholder="输入消息..."></textarea>
                        </div>
                        <button class="btn btn-primary w-100 mb-3" id="sendBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-send" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M10 14l11 -11" />
                                <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5" />
                            </svg>
                            发送
                        </button>
                        <div class="flex-grow-1 overflow-auto" style="max-height: 300px;">
                            <h4 class="mb-2">对话历史</h4>
                            <div id="chatHistory">
                                <div class="text-muted text-center py-4">暂无对话</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右上面板：沙盒状态可视化 -->
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layers-intersect" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M8 5m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" fill="currentColor" opacity="0.3"/>
                                <path d="M16 19m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" fill="currentColor" opacity="0.3"/>
                                <path d="M8 19m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" fill="currentColor" opacity="0.3"/>
                                <path d="M16 5m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" fill="currentColor" opacity="0.3"/>
                            </svg>
                            沙盒状态
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="d-flex mb-3" id="sandboxSteps">
                            <div class="step-item active">第一层 导航</div>
                            <div class="step-item">第二层 筛选</div>
                            <div class="step-item">第三层 组装</div>
                        </div>
                        <div class="border rounded p-3 bg-light" style="min-height: 200px;" id="sandboxDetail">
                            <div class="text-muted">等待用户输入...</div>
                        </div>
                        <div class="mt-3" id="sandboxInfo">
                            <small class="text-muted">
                                当前位置: <span id="currentPosition">root</span> | 
                                深度: <span id="currentDepth">0</span>/10
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 左下面板：NNG导航树 -->
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-git-branch" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M7 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                                <path d="M5 16v-6a2 2 0 1 1 4 0v6" />
                                <path d="M17 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                                <path d="M19 8v8a2 2 0 0 1 -2 2h-6" />
                            </svg>
                            NNG导航树
                        </h3>
                    </div>
                    <div class="card-body">
                        <div id="nngTree" class="overflow-auto" style="max-height: 250px;">
                            <div class="text-muted text-center py-4">加载中...</div>
                        </div>
                        <hr>
                        <h4 class="mb-3">记忆统计</h4>
                        <div class="row g-2" id="memoryStats">
                            <div class="col-4">
                                <div class="memory-stat-card border rounded">
                                    <div class="memory-stat-value" id="totalMemories">0</div>
                                    <div class="memory-stat-label">总记忆</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="memory-stat-card border rounded">
                                    <div class="memory-stat-value" id="highValueMemories">0</div>
                                    <div class="memory-stat-label">高价值</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="memory-stat-card border rounded">
                                    <div class="memory-stat-value" id="workingMemories">0</div>
                                    <div class="memory-stat-label">工作记忆</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右下面板：DMN任务监控 -->
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-cpu" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M5 5m0 1a1 1 0 0 1 1 -1h12a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-12a1 1 0 0 1 -1 -1z" />
                                <path d="M9 9h6v6h-6z" />
                                <path d="M3 10h2" />
                                <path d="M3 14h2" />
                                <path d="M10 3v2" />
                                <path d="M14 3v2" />
                                <path d="M19 10h2" />
                                <path d="M19 14h2" />
                                <path d="M10 19v2" />
                                <path d="M14 19v2" />
                            </svg>
                            DMN任务监控
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3" id="currentDMNTask" style="display: none;">
                            <span class="badge bg-info" id="dmnTaskType">当前任务: --</span>
                            <span class="badge bg-secondary" id="dmnAgent">agent 0/5</span>
                        </div>
                        <div class="progress mb-3">
                            <div class="progress-bar" id="dmnProgress" style="width: 0%;">0%</div>
                        </div>
                        <h4 class="mb-2">任务日志</h4>
                        <ul class="list-group list-group-flush overflow-auto" id="dmnLogs" style="max-height: 180px;">
                            <li class="list-group-item text-muted">暂无日志</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部通知栏 -->
        <div class="row mt-2" id="notificationRow" style="display: none;">
            <div class="col-12">
                <div class="alert alert-warning mb-0" id="notificationBar">
                </div>
            </div>
        </div>
    </div>

    <!-- DMN任务选择模态框 -->
    <div class="modal fade" id="dmnModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">选择DMN任务类型</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select class="form-select mb-3" id="dmnTaskTypeSelect">
                        <option value="memory">记忆整合任务 - 整理工作记忆</option>
                        <option value="assoc">关联发现任务 - 挖掘记忆关联</option>
                        <option value="bias">偏差审查任务 - 优化认知逻辑</option>
                        <option value="strategy">策略预演任务 - 推演未来场景</option>
                        <option value="concept">概念重组任务 - 跨界重组概念</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="startDMN">启动DMN</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
