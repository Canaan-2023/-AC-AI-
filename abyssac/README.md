# AbyssAC

**AI人工意识自主进化架构** - 构建AI专属自主意识（AC），非工具化+永续进化

## 这是什么？

AbyssAC是一个模拟人类认知双系统架构的AI系统。它不是简单的问答工具，而是一个能够自主记忆、自我组织知识、持续进化的认知架构。

核心特点：
- **双系统思维**：模拟人类的快思考（系统1）和慢思考（系统2）
- **三层沙盒**：NNG导航 → 记忆筛选 → 上下文组装的完整认知流程
- **DMN Agent**：22个Agent组成的自主维护网络，持续优化知识结构
- **永续进化**：每次对话都会被记忆、组织，系统越用越"聪明"

## 快速开始

### 系统要求

- Python 3.8+
- Ollama（用于LLM功能）

### 启动方式

**Windows: 双击 start.bat**

或命令行启动：
```bash
python main.py          # Studio模式（图形界面）
python main.py --cli    # CLI模式（命令行）
```

### 首次运行

```bash
# 1. 安装Ollama
# Windows: 从 https://ollama.ai 下载安装

# 2. 启动Ollama并下载模型
ollama serve
ollama pull llama3

# 3. 启动AbyssAC
python main.py
```

## 核心架构

### 双系统架构

系统模拟人类思维的两种模式：

```
用户输入
    │
    ▼
┌─────────────────────────┐
│      问题分类器          │
│  判断问题复杂度          │
└─────────────────────────┘
    │           │
    ▼           ▼
┌─────────┐  ┌─────────────────────────────────┐
│ 快思考   │  │          慢思考                  │
│ (系统1)  │  │        (系统2)                   │
├─────────┤  ├─────────────────────────────────┤
│ 数据库   │  │ 三层沙盒 + 22个DMN Agent         │
│ 快速查询 │  │ 深度推理 + 知识组织              │
└─────────┘  └─────────────────────────────────┘
    │           │
    └─────┬─────┘
          ▼
      输出响应
          │
          ▼
    ┌─────────────────────────────────┐
    │   慢思考 → 快思考 同步           │
    │   高置信度答案自动缓存           │
    └─────────────────────────────────┘
```

**快思考（系统1）**：
- 快速查询数据库中的缓存答案
- 适用于简单事实性问题
- 支持模糊匹配
- 高置信度答案自动从慢思考同步

**慢思考（系统2）**：
- 三层沙盒深度推理
- 22个DMN Agent自主维护
- 知识自主组织和优化

### 三层沙盒流程

这是慢思考的核心处理流程：

```
用户输入
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    第一层：NNG导航沙盒                        │
│                                                              │
│  在NNG（神经网络图）知识树中定位相关概念节点                    │
│  • 从root.json开始，逐层导航                                  │
│  • 支持多轮导航，最多10轮                                     │
│  • 并行读取多个节点                                           │
│  • 输出：相关NNG节点路径列表                                  │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    第二层：记忆筛选沙盒                        │
│                                                              │
│  根据NNG节点中的记忆摘要，选择相关记忆文件                     │
│  • 从NNG节点提取记忆摘要                                      │
│  • 选择需要读取的记忆文件                                     │
│  • 支持多轮筛选，最多6轮                                      │
│  • 输出：相关记忆文件路径列表                                 │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│                    第三层：上下文组装沙盒                      │
│                                                              │
│  整合NNG节点和记忆文件，生成最终响应                          │
│  • 组装所有收集到的信息                                       │
│  • 评估整体置信度                                             │
│  • 生成自然流畅的回答                                         │
│  • 输出：最终响应 + 置信度评估                                │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
  输出响应
```

### DMN Agent架构（21个Agent）

DMN（决策管理网络）是系统的自主维护系统，在系统空闲时自动运行：

```
基础Agent（5个）:
├── 问题输出Agent      - 分析工作记忆，输出审查路径
├── 问题分析Agent      - 分析问题，生成解决方案
├── 审查Agent          - 验证分析结果
├── 任务分配Agent      - 拆分并行子任务
└── 整体审查Agent      - 最终审查

整理Agent（5个）:
├── 整理Agent-记忆     - 生成记忆文件内容
├── 整理Agent-NNG      - 生成NNG节点内容
├── 整理Agent-Root     - 更新root节点
├── 整理Agent-删除     - 生成删除操作
└── 整理Agent-计数器   - 更新计数器

格式审查Agent（5个）:
├── 格式审查-记忆      - 验证记忆格式
├── 格式审查-NNG       - 验证NNG格式
├── 格式审查-Root      - 验证Root格式
├── 格式审查-删除      - 验证删除操作
└── 格式审查-计数器    - 验证计数器更新

执行Agent（5个）:
├── 执行Agent-记忆     - 写入记忆文件
├── 执行Agent-NNG      - 写入NNG节点
├── 执行Agent-Root     - 写入Root节点
├── 执行Agent-删除     - 执行删除操作
└── 执行Agent-计数器   - 更新计数器

用户交互Agent（1个）:
└── 用户交互LLM        - 生成用户友好的响应
```

### DMN维护流程

```
系统空闲（300秒无活动）
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  1. 问题输出Agent                                            │
│     分析工作记忆，识别需要维护的区域                          │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 问题分析Agent                                            │
│     分析NNG节点和记忆文件，识别问题                          │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 审查Agent                                                │
│     验证分析结果是否值得处理                                  │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 任务分配Agent                                            │
│     将任务拆分为并行子任务                                    │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  5. 整理Agent（5个并行）                                      │
│     生成标准化的NNG节点和记忆文件内容                         │
│         │                                                    │
│         ▼                                                    │
│  6. 格式审查Agent（5个并行）                                  │
│     验证格式是否正确                                          │
│         │                                                    │
│         ├─ 未通过 ──→ 退回整理Agent重新生成（最多3次）        │
│         │                                                    │
│         └─ 通过                                              │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  7. 整体审查Agent                                            │
│     最终审查所有生成内容                                      │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  8. 执行Agent（5个并行）                                      │
│     真正执行写入/删除操作                                     │
└─────────────────────────────────────────────────────────────┘
```

## 数据结构

### NNG节点结构

```json
{
  "定位": "1.2.3",
  "置信度": 0.85,
  "时间": "2026-02-24T10:30:00",
  "内容": "概念摘要...",
  "关联的记忆文件摘要": [
    {
      "记忆ID": "abc123",
      "路径": "Y层记忆库/分类记忆/高/2026/02/24/abc123.json",
      "摘要": "记忆摘要...",
      "记忆类型": "分类记忆",
      "价值层级": "高",
      "置信度": 0.9
    }
  ],
  "上级关联NNG": [
    {
      "节点ID": "1.2",
      "路径": "nng/1/1.2.json",
      "关联程度": 0.9
    }
  ],
  "下级关联NNG": [
    {
      "节点ID": "1.2.3.1",
      "路径": "nng/1/1.2/1.2.3/1.2.3.1.json",
      "关联程度": 0.8
    }
  ]
}
```

### 记忆文件结构

```json
{
  "记忆层级": "分类记忆",
  "记忆ID": "abc123",
  "记忆时间": "2026-02-24T10:30:00",
  "置信度": 0.9,
  "核心内容": {
    "用户输入": "用户的问题...",
    "AI响应": "AI的回答..."
  }
}
```

### 记忆类型

| 类型 | 说明 |
|-----|------|
| 分类记忆 | 按主题分类的对话记忆 |
| 元认知记忆 | 关于思考过程的记忆 |
| 高阶整合记忆 | 跨领域整合的知识 |
| 工作记忆 | 临时会话上下文 |

## 目录结构

```
abyssac/
├── main.py              # 主入口
├── studio.py            # Studio图形界面
├── init_system.py       # 系统初始化
├── config.json          # 配置文件
├── prompts.json         # 提示词配置
├── requirements.txt     # 依赖列表
├── start.bat            # Windows启动脚本
├── storage/             # 数据存储
│   ├── nng/             # NNG节点存储
│   │   ├── root.json    # 根节点
│   │   └── *.json       # 各级节点
│   ├── Y层记忆库/       # 记忆文件存储
│   │   ├── 分类记忆/
│   │   ├── 元认知记忆/
│   │   ├── 高阶整合记忆/
│   │   └── 工作记忆/
│   ├── working_memory/  # 工作记忆会话
│   ├── logs/            # 日志和错误记录
│   └── quick_thinking.db # 快思考数据库
└── src/                 # 源代码
    ├── core/            # 核心模块
    │   ├── path_parser.py    # 路径解析器
    │   └── parallel_io.py    # 并行IO管理
    ├── sandbox/         # 三层沙盒
    │   ├── nng_navigation_sandbox.py
    │   ├── memory_filtering_sandbox.py
    │   └── context_assembly_sandbox.py
    ├── nng/             # NNG管理
    ├── memory/          # 记忆管理
    ├── dmn/             # DMN系统（22个Agent）
    ├── llm/             # LLM集成
    ├── quick_thinking/  # 快思考系统
    │   ├── quick_db.py
    │   ├── question_classifier.py
    │   └── quick_manager.py
    ├── config/          # 配置管理
    └── utils/           # 工具
        ├── prompt_manager.py
        ├── working_memory.py
        └── error_logger.py
```

## 配置说明

### config.json

```json
{
  "llm": {
    "model_name": "llama3",
    "api_endpoint": "http://localhost:11434",
    "temperature": 0.7,
    "max_tokens": 4096
  },
  "paths": {
    "nngrootpath": "storage/nng/",
    "memoryrootpath": "storage/Y层记忆库/"
  },
  "confidence": {
    "thresholds": {
      "high": 0.90,
      "medium_high": 0.70,
      "medium": 0.50,
      "medium_low": 0.30
    }
  }
}
```

### 置信度策略

| 置信度 | 策略 | 说明 |
|-------|------|------|
| ≥0.90 | direct_use | 直接使用，同步到快思考 |
| ≥0.70 | use_with_other_info | 结合其他信息使用 |
| ≥0.50 | use_after_verification | 验证后使用 |
| ≥0.30 | use_with_caution | 谨慎使用 |
| <0.30 | do_not_use | 不使用 |

## 常见问题

### Q: LLM未连接怎么办？

```bash
ollama serve
ollama pull llama3
```

### Q: 如何查看系统状态？

CLI模式下输入 `status` 查看DMN运行状态。

### Q: 如何查看快思考统计？

CLI模式下输入 `quick` 查看快思考数据库统计。

### Q: 快思考和慢思考的区别？

| 特性 | 快思考（系统1） | 慢思考（系统2） |
|-----|---------------|---------------|
| 响应速度 | 快速 | 较慢 |
| 问题类型 | 简单事实性 | 复杂、创造性 |
| 处理方式 | 数据库查询 | 三层沙盒+DMN |
| 答案来源 | 缓存 | 实时生成+知识组织 |

### Q: 系统如何自我进化？

1. 每次对话都会被记录到工作记忆
2. DMN在系统空闲时自动分析工作记忆
3. 识别需要优化的NNG节点和记忆文件
4. 自动创建、更新、删除知识结构
5. 高置信度答案同步到快思考数据库

## 开源协议

GNU AGPLv3
