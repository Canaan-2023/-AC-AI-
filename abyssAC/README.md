# æ¸Šåè®®MCPæ’ä»¶ç³»ç»Ÿ

> **Abyss Protocol MCP Plugin System** - æ¨¡å‹-æ§åˆ¶å™¨-æ’ä»¶æ¶æ„çš„å®Œæ•´å®ç°


---

## âœ¨ ç‰¹æ€§æ¦‚è§ˆ

### ğŸ—ï¸ ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ’ä»¶å±‚ (Plugin)                       â”‚
â”‚    è®¤çŸ¥æ’ä»¶ | è®°å¿†æ’ä»¶ | å­—å…¸æ’ä»¶ | APIæ’ä»¶ | ç›‘æ§æ’ä»¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ§åˆ¶å™¨å±‚ (Controller)                   â”‚
â”‚    APIæ§åˆ¶å™¨ | è®°å¿†æ§åˆ¶å™¨ | å­—å…¸æ§åˆ¶å™¨                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¨¡å‹å±‚ (Model)                        â”‚
â”‚    å­—å…¸ç®¡ç†å™¨ | è®°å¿†ç³»ç»Ÿ | è®¤çŸ¥å†…æ ¸ | åˆ†è¯å™¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **åå‘ç´¢å¼•ç³»ç»Ÿ** - å¤§å¹…æå‡æ£€ç´¢æ€§èƒ½
- âœ… **æ— å¤–éƒ¨ä¾èµ–** - çº¯Pythonæ ‡å‡†åº“å®ç°
- âœ… **å®Œæ•´APIæ¥å£** - RESTful APIæ”¯æŒ
- âœ… **æ’ä»¶ç³»ç»Ÿ** - åŠ¨æ€åŠ è½½å’Œæ‰©å±•
- âœ… **å†…å­˜ç›‘æ§** - å†…ç½®å†…å­˜ä½¿ç”¨ç›‘æ§
- âœ… **å¹¶å‘å®‰å…¨** - å®Œæ•´çš„çº¿ç¨‹å®‰å…¨ä¿æŠ¤
- âœ… **æŒä¹…åŒ–** - è‡ªåŠ¨çŠ¶æ€ä¿å­˜å’Œæ¢å¤

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

- **çº¯Pythonå®ç°**: æ— éœ€å®‰è£…ä»»ä½•å¤–éƒ¨ä¾èµ–
- **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **é«˜æ€§èƒ½**: åå‘ç´¢å¼•+å¤šçº§ç¼“å­˜
- **çº¿ç¨‹å®‰å…¨**: å®Œå–„çš„å¹¶å‘ä¿æŠ¤
- **RESTful API**: å®Œæ•´çš„HTTPæ¥å£
- **æ’ä»¶æ¶æ„**: æ”¯æŒåŠ¨æ€æ‰©å±•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.6 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ— éœ€å¤–éƒ¨ä¾èµ–

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
https://github.com/Canaan-2023/-AC-AI-

# è¿è¡Œç¤ºä¾‹
python main.py --examples
```

### åŸºæœ¬ä½¿ç”¨

```python
from abyss_mcp_plugin import AbyssKernel

# åˆ›å»ºå†…æ ¸
kernel = AbyssKernel()

# åˆå§‹åŒ–
kernel.initialize()

# å¤„ç†æ–‡æœ¬
result = kernel.process
print(result)

# æ¸…ç†èµ„æº
kernel.cleanup()
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

#### 1. æ¨¡å‹å±‚ (Model)

**å­—å…¸ç®¡ç†å™¨ (DictionaryManager)**
- åˆ†å¸ƒå¼å­—å…¸ç®¡ç†
- åå‘ç´¢å¼•æ”¯æŒ
- è‡ªåŠ¨è£‚å˜æœºåˆ¶
- æ€å°„åœºåˆ†æ

**è®°å¿†ç³»ç»Ÿ (MemorySystem)**
- å››å±‚è®°å¿†æ¶æ„
- æ™ºèƒ½æ¸…ç†ç­–ç•¥
- è®°å¿†èåˆåŠŸèƒ½
- åå‘ç´¢å¼•æ£€ç´¢

**è®¤çŸ¥å†…æ ¸ (CognitiveKernel)**
- è®¤çŸ¥æ¿€æ´»æœºåˆ¶
- æ¿€æ´»ä¼ æ’­
- æ¼‚ç§»åˆ†æ
- æ¨¡å¼è¯†åˆ«

**åˆ†è¯å™¨ (LightweightTokenizer)**
- ä¸­è‹±æ–‡æ··åˆåˆ†è¯
- æ— å¤–éƒ¨ä¾èµ–
- æ ¸å¿ƒæ¦‚å¿µè¯†åˆ«
- æ¿€æ´»ç¼“å­˜

#### 2. æ§åˆ¶å™¨å±‚ (Controller)

**APIæ§åˆ¶å™¨ (APIController)**
- RESTful APIæ¥å£
- é™æµæ§åˆ¶
- CORSæ”¯æŒ
- å¥åº·æ£€æŸ¥

**è®°å¿†æ§åˆ¶å™¨ (MemoryController)**
- è®°å¿†CRUDæ“ä½œ
- æœç´¢å’Œæ£€ç´¢
- èåˆç®¡ç†

**å­—å…¸æ§åˆ¶å™¨ (DictionaryController)**
- å­—å…¸ç®¡ç†
- è¯æœç´¢
- è£‚å˜è§¦å‘

#### 3. æ’ä»¶å±‚ (Plugin)

**æ’ä»¶ç®¡ç†å™¨ (PluginManager)**
- è‡ªåŠ¨å‘ç°åŠ è½½
- ç”Ÿå‘½å‘¨æœŸç®¡ç†
- é…ç½®ç®¡ç†
- äº‹ä»¶é€šä¿¡

**æ’ä»¶ç±»å‹**
- è®¤çŸ¥æ’ä»¶ (CognitivePlugin)
- è®°å¿†æ’ä»¶ (MemoryPlugin)
- å­—å…¸æ’ä»¶ (DictionaryPlugin)
- APIæ’ä»¶ (APIPlugin)
- ç›‘æ§æ’ä»¶ (MonitorPlugin)
- é›†æˆæ’ä»¶ (IntegrationPlugin)

---

## ğŸ”Œ APIæ¥å£

### åŸºç¡€URL

```
http://127.0.0.1:8080
```

### æ ¸å¿ƒæ¥å£

#### å¤„ç†æ–‡æœ¬

```http
POST /api/process
Content-Type: application/json

{
  "text": "æ¸Šåè®®å¼ºè°ƒæ„è¯†å¹³ç­‰æ€§",
  "return_metadata": false
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "memory_id": "mem_0_1234567890",
  "keywords": ["æ¸Šåè®®", "æ„è¯†", "å¹³ç­‰æ€§"],
  "activation_count": 3,
  "processing_time": 0.015
}
```

#### åˆ›å»ºè®°å¿†

```http
POST /api/memory
Content-Type: application/json

{
  "content": "é‡è¦è®¤çŸ¥å‘ç°",
  "category": "è®¤çŸ¥",
  "layer": "INTEGRATION"
}
```

#### æœç´¢è®°å¿†

```http
GET /api/memory/search?query=è®¤çŸ¥&limit=10
```

#### è·å–å­—å…¸ç»Ÿè®¡

```http
GET /api/dictionary
```

#### ç³»ç»Ÿå¥åº·æ£€æŸ¥

```http
GET /api/health
```

#### è·å–ç³»ç»Ÿç»Ÿè®¡

```http
GET /api/stats
```

---

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### åˆ›å»ºæ’ä»¶

```python
from abyss_mcp_plugin.plugins.plugin_base import (
    CognitivePlugin, PluginInfo, PluginType
)

class MyPlugin(CognitivePlugin):
    PLUGIN_INFO = {
        "name": "MyPlugin",
        "version": "1.0.0",
        "description": "æˆ‘çš„è®¤çŸ¥æ’ä»¶",
        "author": "Your Name",
        "type": "cognitive",
        "dependencies": []
    }
    
    def initialize(self, kernel, config=None):
        self.kernel = kernel
    
    def process_activation(self, text, activations):
        # å¤„ç†æ¿€æ´»
        return activations
    
    def enhance_tokenization(self, tokens):
        # å¢å¼ºåˆ†è¯
        return tokens
```

### ä½¿ç”¨æ’ä»¶

```python
# åŠ è½½æ’ä»¶
kernel.plugin_manager.load_plugin("./plugins/my_plugin.py")

# åˆå§‹åŒ–æ’ä»¶
kernel.plugin_manager.initialize_plugins(kernel)
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä½äº `config/abyss_config.json`

### ä¸»è¦é…ç½®é¡¹

#### ç³»ç»Ÿé…ç½®

```json
{
  "system": {
    "auto_save_interval": 300,
    "health_check_interval": 60,
    "max_memory_mb": 500,
    "base_path": "./abyss_mcp_data"
  }
}
```

#### å­—å…¸é…ç½®

```json
{
  "dictionary": {
    "max_dict_size": 5000,
    "max_dict_files": 20,
    "fission_enabled": true,
    "split_threshold": 0.8
  }
}
```

#### APIé…ç½®

```json
{
  "api": {
    "enabled": true,
    "host": "127.0.0.1",
    "port": 8080,
    "rate_limit": {
      "enabled": true,
      "requests_per_minute": 60
    }
  }
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. äº¤äº’æ¨¡å¼

```bash
python main.py --interactive
```

### 2. å¤„ç†æ–‡æœ¬

```bash
python main.py --process "æ¸Šåè®®å¼ºè°ƒæ„è¯†å¹³ç­‰æ€§"
```

### 3. è¿è¡Œç¤ºä¾‹

```bash
python main.py --examples
```

### 4. å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼

```bash
python main.py --daemon
```

### 5. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```bash
python main.py --config ./config/custom.json --interactive
```

---

## ğŸ’» ç¤ºä¾‹ä»£ç 

### åŸºæœ¬æ–‡æœ¬å¤„ç†

```python
from abyss_mcp_plugin import AbyssKernel

kernel = AbyssKernel()
kernel.initialize()

# å¤„ç†æ–‡æœ¬
result = kernel.process("æ¸Šåè®®å¼ºè°ƒæ„è¯†å¹³ç­‰æ€§")
print(f"å…³é”®è¯: {result['keywords']}")
print(f"æ¿€æ´»èŠ‚ç‚¹: {result['activation_count']}")

kernel.cleanup()
```

### è®°å¿†æ“ä½œ

```python
# åˆ›å»ºè®°å¿†
memory_id = kernel.memory.create_memory(
    content="é‡è¦è®¤çŸ¥å‘ç°",
    layer=MemoryLayer.INTEGRATION,
    category="è®¤çŸ¥"
)

# æœç´¢è®°å¿†
results = kernel.memory.retrieve_memory("è®¤çŸ¥", limit=5)
for mem in results:
    print(f"{mem.id}: {mem.content}")

# èåˆè®°å¿†
fused_ids = kernel.memory.fuse_related_memories("è®¤çŸ¥")
```

### å­—å…¸æ“ä½œ

```python
# æ·»åŠ è¯
dict_id = kernel.dict_manager.add_word("äººå·¥æ™ºèƒ½")

# æœç´¢è¯
words = kernel.dict_manager.search_words("æœºå™¨", limit=10)
print(words)

# è§¦å‘è£‚å˜
result = kernel.dict_manager.check_and_perform_fission()
```

### APIè°ƒç”¨

```python
# ä½¿ç”¨å†…éƒ¨API
api = kernel.api_controller

# å¤„ç†æ–‡æœ¬
result = api.make_request('POST', '/api/process', {
    'text': 'ç¤ºä¾‹æ–‡æœ¬'
})

# æœç´¢è®°å¿†
results = api.make_request('GET', '/api/memory/search?query=è®¤çŸ¥')
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### åå‘ç´¢å¼•

ç³»ç»Ÿä½¿ç”¨åå‘ç´¢å¼•å¤§å¹…æå‡æ£€ç´¢æ€§èƒ½ï¼š

- **å…³é”®è¯ç´¢å¼•**: O(1) æŸ¥æ‰¾
- **ç±»åˆ«ç´¢å¼•**: å¿«é€Ÿåˆ†ç±»æ£€ç´¢
- **å±‚çº§ç´¢å¼•**: åˆ†å±‚è®°å¿†è®¿é—®

### å¤šçº§ç¼“å­˜

- **L1ç¼“å­˜**: LRUç­–ç•¥ï¼Œé«˜é¢‘è®¿é—®
- **L2ç¼“å­˜**: TTLç­–ç•¥ï¼Œä¸­é¢‘è®¿é—®
- **L3ç¼“å­˜**: LFUç­–ç•¥ï¼Œä½é¢‘è®¿é—®

### å†…å­˜ä¼˜åŒ–

- **æ™ºèƒ½æ¸…ç†**: åŸºäºé‡è¦æ€§å’Œä½¿ç”¨é¢‘ç‡
- **è‡ªåŠ¨GC**: å®šæœŸåƒåœ¾å›æ”¶
- **å†…å­˜ç›‘æ§**: å®æ—¶å†…å­˜ä½¿ç”¨ç›‘æ§

---

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—ç³»ç»Ÿ

```python
from abyss_mcp_plugin.core.logger import AbyssLogger

logger = AbyssLogger("MyApp")
logger.info("åº”ç”¨å¯åŠ¨")
logger.error("å‘ç”Ÿé”™è¯¯", exc_info=True)
```

### å†…å­˜ç›‘æ§

```python
from abyss_mcp_plugin.core.memory_monitor import memory_monitor

# è·å–å†…å­˜ä¿¡æ¯
info = memory_monitor.get_current_memory_usage()
print(f"å†…å­˜ä½¿ç”¨: {info['memory_mb']:.1f}MB")

# å¼ºåˆ¶GC
result = memory_monitor.force_gc()
print(f"é‡Šæ”¾å†…å­˜: {result['freed_mb']:.1f}MB")
```

### äº‹ä»¶ç³»ç»Ÿ

```python
from abyss_mcp_plugin.core.event_system import event_system

# è®¢é˜…äº‹ä»¶
def on_memory_created(event):
    print(f"æ–°è®°å¿†åˆ›å»º: {event.data['memory_id']}")

event_system.subscribe_callback('memory.created', on_memory_created)
```
